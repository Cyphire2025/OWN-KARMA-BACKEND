"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const awilix_1 = require("@medusajs/framework/awilix");
const modules_sdk_1 = require("@medusajs/framework/modules-sdk");
const _types_1 = require("../types");
const medusa_cloud_auth_1 = require("../providers/medusa-cloud-auth");
const validateCloudOptions = (options) => {
    const { oauth_authorize_endpoint, oauth_token_endpoint, environment_handle, sandbox_handle, api_key, callback_url, } = options ?? {};
    if (!environment_handle && !sandbox_handle) {
        return false;
    }
    if (!oauth_authorize_endpoint ||
        !oauth_token_endpoint ||
        !api_key ||
        !callback_url) {
        return false;
    }
    return true;
};
const registrationFn = async (klass, container, pluginOptions) => {
    container.register({
        [_types_1.AuthProviderRegistrationPrefix + pluginOptions.id]: (0, awilix_1.asFunction)((cradle) => new klass(cradle, pluginOptions.options ?? {}), {
            lifetime: klass.LIFE_TIME || awilix_1.Lifetime.SINGLETON,
        }),
    });
    container.registerAdd(_types_1.AuthIdentifiersRegistrationName, (0, awilix_1.asValue)(pluginOptions.id));
};
exports.default = async ({ container, options, }) => {
    if (validateCloudOptions(options?.cloud) && !options?.cloud?.disabled) {
        await registrationFn(medusa_cloud_auth_1.MedusaCloudAuthService, container, {
            options: options?.cloud,
            id: "cloud",
        });
    }
    await (0, modules_sdk_1.moduleProviderLoader)({
        container,
        providers: options?.providers || [],
        registerServiceFn: registrationFn,
    });
};
//# sourceMappingURL=providers.js.map